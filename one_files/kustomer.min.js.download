!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";const t=t=>"en"===t,e=t=>"zh_tw"===t,n=t=>e(t)||(t=>"zh_cn"===t)(t),r=t=>"nl"===t,a=t=>"de"===t,o=t=>"fr"===t,i=t=>"es_us"===t,s=t=>"es_eu"===t,c=t=>"it"===t,u=t=>"ja"===t,d=(t,e={})=>{localStorage&&"true"===localStorage.getItem("kustomerDebug")&&(e.error?console.error("Kustomer Chat: ",e.error):console.debug("Kustomer Chat: ",t,e))},l=(t,e)=>{t&&(t instanceof NodeList?t.forEach((t=>t.addEventListener("click",e))):t.addEventListener("click",e))},g=0,h=6,m=e=>t(e)||i(e),f=t=>o(t)||a(t)||s(t)||r(t)||c(t),p=1,w=10,S=11,v=12,y=(t,e)=>{const n=new Date(t).toLocaleString("en-US",{timeZone:e,dateStyle:"full",timeStyle:"full"});return n.indexOf("Daylight")>-1||n.indexOf("Summer")>-1};const b=()=>{try{if(!window.digitalData)return void d("Data Bridge Not Found for Kustomer Settings");if(localStorage&&"true"===localStorage.getItem("kustomerEnabledV2")&&(d("Local Storage Override Found, enabling"),digitalData.set("chatSettings.enabledV2",!0)),window.digitalData.get("flag.kustomer-chat-v2-enabled",!1)&&(d("Launch Darkly Override found, enabling"),digitalData.set("chatSettings.enabledV2",!0)),!digitalData.get("chatSettings.enabledV2",!1))return d("Kustomer Chat V2 Not Enabled"),void digitalData.set("chatSettings.isOnline",!1);d("Kustomer Chat Activated");const b=digitalData.get("chatSettings.country"),[D,C]=((t,e)=>{let n=t,r=t;return"zh"===t&&(n="cn"===e?"zh_cn":"zh_tw",r="cn"===e?"zh_cn":"zh_tw"),"es"===t&&(n="us"===e||"world"===e?"es_us":"es_eu"),[n,r]})(digitalData.get("chatSettings.language"),b);if((t=>{d("Inside emergencyShutoff",{data:window.utag?.data});const e=window.utag&&(window.utag?.data?.kustomer_emergency_shutoff||window.utag?.data?.kustomer_shutoff||window.digitalData.get("flag.kustomer-chat-emergency-shutoff",""));if(e&&(d("Emergency Shutoff Defined",{kustomerEmergencyShutoff:e}),e.split("|").indexOf(t)>-1))return!0;if(window.digitalData.get("flag.kustomer-chat-emergency-shutoff","")&&(d("Emergency Shutoff Defined",{kustomer_emergency_shutoff:window.digitalData.get("flag.kustomer-chat-emergency-shutoff")}),window.digitalData.get("flag.kustomer-chat-emergency-shutoff").split("|").indexOf(t)>-1))return!0;return!1})(D))return void digitalData.set("chatSettings.isOnline",!1);const{host:k,pathname:E}=window.location,I=k.split(".")[0],L=digitalData.get("page.brand"),K=["anf","kids"].indexOf(L)>-1?"Abercrombie & Fitch":"Hollister Co.",O=digitalData.get("page.pageName"),A=digitalData.get("page.pageKind"),_=O||A||"",T=function(t,e=""){if("home"===e)return"";const n=t.split("/");return 3===n.length?n[2]:n.length>3?n.slice(3).join("/"):t}(E,O),q="www"===I?digitalData.get("chatSettings.assistantId"):"",x=digitalData.get("chatSettings.apiKey"),N=digitalData.get("chatSettings.brandId"),U=digitalData.get("page.storeId"),z=digitalData.get("page.cookie.rxVisitor")||"",H=localStorage&&localStorage.getItem("kustomerDateOverride")?new Date(localStorage.getItem("kustomerDateOverride")):new Date,M=H.getUTCHours(),V=H.getUTCDate(),F=H.getUTCMonth()+1,$=H.getUTCDay(),j=(t=>{const e=`${t}=`,n=decodeURIComponent(document.cookie).split(";");for(let t=0;t<n.length;t+=1){let r=n[t];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(e))return r.substring(e.length,r.length)}return""})("geoLocation");let B,[P,R]=((e,d)=>{if(t(e))return[12,5];if(i(e))return[12,5];if(s(e))return[7,19];if(o(e))return[7,19];if(a(e))return[7,19];if(c(e))return[8,17];if(r(e))return[8,17];if(n(e))return[0,12];if(u(e))return[0,8];throw new Error("No configuration defined")})(D);[P,R]=function(t,e,n,r,i){return m(t)&&e===S&&28===n?[23,5]:(o(t)||a(t)||s(t))&&e===v&&24===n||(o(t)||a(t)||s(t))&&e===v&&31===n?[7,17]:[r,i]}(D,F,V,P,R),((t,e,n)=>m(e)?y(t,"America/New_York"):!!f(e)&&y(t,"Europe/Berlin"))(H,D)&&(0===P?P=23:P-=1,0===R?R=23:R-=1),B=(()=>{if(((a=$)===h||a===g)&&(e(D)||u(D)||c(D)||r(D)))return!1;var a;if((n(D)||u(D))&&F===p&&[29,30,31].includes(V))return!1;if((n(D)||u(D))&&F===w&&1===V)return!1;if(t(D)&&F===S&&[29,30].includes(V))return!0;if(t(D)&&F===v&&[1,2].includes(V))return!0;if((t(D)||i(D))&&F===v&&24===V){if(M>=0&&M<5)return P=0,R=5,!0;if(M>=5&&M<12)return P=12,R=22,!1;if(M>=12&&M<22)return P=12,R=22,!0;if(M>=22)return P=22,R=24,!1}if(f(D)&&F===v&&25===V)return!1;if(m(D)&&F===v&&(25===V||26===V&&M<5))return!1;if((t(D)||i(D))&&F===v&&31===V){if(M>=0&&M<5)return P=0,R=5,!0;if(M>=5&&M<12)return P=5,R=22,!1;if(M>=12&&M<22)return P=12,R=22,!0;if(M>=22)return P=22,R=24,!1}return m(D)&&F===p&&(1===V||2===V&&M<5)&&(P=15,R=23),(!(f(D)||u(D)||n(D))||F!==p||1!==V)&&(d("Hours of operation",{openingHour:P,closingHour:R,currentHour:M}),R>P?M>=P&&M<R:M>=P||M<R)})(),localStorage&&"true"===localStorage.getItem("kustomerForceOpen")&&(B=!0),B||(d("Kustomer Chat is closed"),document.querySelectorAll(".help-chat-button-container,.shopping-bag-chat-button").forEach((t=>t.remove())));const W=(()=>{if(R>P){if(!(M>=P&&M<R+1))return!1}else if(!(M>=P||M<R+1))return!1;try{if(function(t){const e=sessionStorage.getItem("chatActive");if(!e)return!1;const n=new Date(e).getTime(),r=t.getTime()-n;return r<36e5&&r>=0}(H))return!0}catch(t){d("Kustomer Chat failed to run properly: isAlreadyChatting",t)}return!1})(),Y=(()=>{try{return"homepage"!==A&&("checkout"!==A&&!(window.location.href.indexOf("/FastEnroll")>-1))}catch(t){return!1}})(),Z=document.querySelectorAll(".chat-icon-button"),G=document.querySelectorAll(".chat-icon-button-container"),J=Z.length<=0,Q=()=>{const t=document.querySelectorAll(".userMessage, .customerMessage").length,e=document.querySelector(".kustomer-app-container");t>0&&e.classList.add("active-chat")},X=()=>{if(document.querySelectorAll(".kustomer-app-thread div").length>0&&0===document.querySelectorAll(".kustomer-app-container.active-chat").length){const t={childList:!0,subtree:!0},e=new MutationObserver((function(t){t.forEach((t=>{"childList"===t?.type&&Q()}))}));window.setTimeout((()=>{const n=document.querySelector(".kustomer-app-thread div");e.observe(n,t)}),100)}else d("not adding a mutation observer")},tt=()=>{const t=new CustomEvent("kustomerChat:loaded");window.dispatchEvent(t),G.forEach((t=>t.classList.remove("has-unread-messages"))),Kustomer.getOpenConversations((t=>{d(`open conversations:${t.length}`),t.length>0?Kustomer.openConversationById({conversationId:t[0].conversationId}):(d(`creating chat with assistantId=${q}`),q?Kustomer.createConversation({assistantId:q}):Kustomer.createConversation())}));const e=new CustomEvent("analytics.kustomerChat");window.dispatchEvent(e),function(t){sessionStorage.setItem("chatActive",t)}(H),window.setTimeout((()=>{Q()}),100),window.setTimeout((()=>{X()}),100)};let et=!1;const nt=t=>{if(d("inside loadKustomerChat",{openMe:t}),et)d("No need to load library? typeof Kustomer=="+typeof Kustomer),t&&tt();else{et=!0,window.addEventListener("kustomerLoaded",(()=>{d("Calling Kustomer Start");const e={brandId:N,hideChatIcon:!J,lang:C,assistantId:q,hideHistory:!0};q&&(e.assistantId=q),d("kustomerOptions",{kustomerOptions:e}),Kustomer.start(e,(()=>{d("Callback for Kustomer.start"),Kustomer.addListener("onUnread",(t=>{let e;d("Inside onUnread Listener",{response:t});try{e=t?.change?.count}catch(t){e=0}var n,r;d("Kustomer says unread msgs count",{count:e}),e>0&&(r="has-unread-messages",(n=G)instanceof NodeList?n.forEach((t=>t.classList.add(r))):n.classList.add(r),document.dispatchEvent(new CustomEvent("setPoliteText",{detail:digitalData.get("chatSettings.newMessageText","")}))),0===e&&G.forEach((t=>t.classList.remove("has-unread-messages")));const a=new CustomEvent("kustomerChat:loaded");window.dispatchEvent(a),Q(),X()})),Kustomer.addListener("onConversationCreate",((t,e)=>{e&&d("Error in onConversationCreate handler",{error:e});const n={conversationId:t.conversationId,customAttributes:{chatLocationStr:j,pageNameStr:T,pageTypeStr:_,pdpDeptIdStr:digitalData.get("chatSettings.pdpDepartmentId",""),brandStr:K,regionStr:b,webstoreIdStr:`${U}`,sessionIdStr:z,brandCollectionStr:L,hashedUserIdStr:digitalData.get("user.hashedEmail","")}};d("Conversation Options",{conversationOptions:n}),Kustomer.describeConversation(n)})),t&&tt()})),d("After Kustomer Start")})),d("creating Kustomer script element");const e=document.createElement("script");e.src="https://cdn.kustomerapp.com/chat-web/widget.js",e.setAttribute("data-kustomer-api-key",x),window.document.body.appendChild(e)}},rt=()=>{nt(!0)};digitalData.subscribe("event:chat.openChatWindow",rt),l(document.querySelector("#kustomer-root .kustomer-app-header-close-button"),(()=>{var t,e;e="has-unread-messages",(t=G)instanceof NodeList?t.forEach((t=>t.classList.remove(e))):t.classList.remove(e)})),l(document.querySelector("#kustomer-root .kustomer-app-new-conversation-button"),(()=>{document.querySelector(".kustomer-app-container").classList.remove("active-chat")})),l(Z,(()=>{d("inside bound click for chat bubble"),rt()})),B&&Y||W?(digitalData.set("chatSettings.isOnline",!0),Q(),X(),W&&nt(),G.forEach((t=>t.classList.add("show-icon")))):(G.forEach((t=>t.classList.remove("show-icon"))),digitalData.set("chatSettings.isOnline",!1),d("Kustomer Chat not installed on this page",{isChatOpen:B,isChatAllowed:Y,isAlreadyChatting:W}))}catch(t){d("Kustomer Chat failed to run properly",{error:t})}};document.addEventListener("DOMContentLoaded",(()=>{b()}),!1)}));
